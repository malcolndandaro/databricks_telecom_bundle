resources:
  jobs:
    Task_0_Generate_auxiliary_tables:
      name: "Task 0 - Generate Auxiliary Tables"
      tasks:
        - task_key: download_erb_Jul2024
          notebook_task:
            notebook_path:  ../tables/aux_tables/aux_download_erb.py
            base_parameters:
              p_catalog: ${var.catalog_name}
              p_volume: raw_data
            source: WORKSPACE
          job_cluster_key: 00_setup_data_generation_cluster
          libraries:
            - pypi:
                package: Faker==28.4.1
            - pypi:
                package: dbldatagen==0.4.0.post1
        - task_key: carga_erb
          depends_on:
            - task_key: download_erb_Jul2024
          notebook_task:
            notebook_path:  ../tables/aux_tables/aux_erb_carga.py
            base_parameters:
              p_catalog: ${var.catalog_name}
              p_volume: raw_data
            source: WORKSPACE
          job_cluster_key: 00_setup_data_generation_cluster
          libraries:
            - pypi:
                package: Faker==28.4.1
            - pypi:
                package: dbldatagen==0.4.0.post1
        - task_key: datalake_structure_uc_volumes
          depends_on:
            - task_key: carga_erb
          notebook_task:
            notebook_path:  ../volumes/datalake_and_UC_volumes.py
            base_parameters:
              p_schema: ingestion
              p_volume: raw_data
            source: WORKSPACE
          job_cluster_key: 00_setup_data_generation_cluster
          libraries:
            - pypi:
                package: Faker==28.4.1
            - pypi:
                package: dbldatagen==0.4.0.post1        
        - task_key: aux_tables_-_municipios
          depends_on:
            - task_key: datalake_structure_uc_volumes
          notebook_task:
            notebook_path: ../tables/aux_tables/aux_tbl_municipios.py
            base_parameters:
              p_schema: misc
            source: WORKSPACE
          job_cluster_key: 00_setup_data_generation_cluster
        - task_key: aux_functions_-_address
          depends_on:
            - task_key: aux_tables_-_municipios
          notebook_task:
            notebook_path: ../tables/aux_functions/address.py
            base_parameters:
              p_schema: misc
            source: WORKSPACE
          job_cluster_key: 00_setup_data_generation_cluster
        - task_key: aux_enderecos
          depends_on:           
            - task_key: aux_functions_-_address
          notebook_task:
            notebook_path:  ../tables/aux_tables/aux_enderecos.py
            base_parameters:
              p_catalog: ${var.catalog_name}              
            source: WORKSPACE
          job_cluster_key: 00_setup_data_generation_cluster
          libraries:
            - pypi:
                package: Faker==28.4.1
            - pypi:
                package: dbldatagen==0.4.0.post1
        - task_key: aux_tbl_index_erbs
          depends_on:
            - task_key: aux_enderecos
          notebook_task:
            notebook_path:  ../tables/aux_tables/aux_tbl_index_erbs.py
            base_parameters:
              p_catalog: ${var.catalog_name}              
            source: WORKSPACE
          job_cluster_key: 00_setup_data_generation_cluster
          libraries:
            - pypi:
                package: Faker==28.4.1
            - pypi:
                package: dbldatagen==0.4.0.post1 
        - task_key: aux_tables_-_produtos
          depends_on:
            - task_key: datalake_structure_uc_volumes
          notebook_task:
            notebook_path: ../tables/aux_tables/aux_tbl_produtos.py
            base_parameters:
              p_schema: misc
            source: WORKSPACE
          job_cluster_key: 00_setup_data_generation_cluster
        - task_key: aux_tables_-_servicos
          depends_on:
            - task_key: datalake_structure_uc_volumes
          notebook_task:
            notebook_path: ../tables/aux_tables/aux_tbl_serviços.py
            base_parameters:
              p_schema: misc
            source: WORKSPACE
          job_cluster_key: 00_setup_data_generation_cluster
        - task_key: aux_tables_-_clientes
          depends_on:
            - task_key: aux_tables_-_produtos
            - task_key: aux_tables_-_servicos
            - task_key: aux_tbl_index_erbs
          notebook_task:
            notebook_path: ../tables/aux_tables/aux_tbl_clientes.py
            base_parameters:
              p_schema: misc
            source: WORKSPACE
          job_cluster_key: 00_setup_data_generation_cluster
      job_clusters:
        - job_cluster_key: 00_setup_data_generation_cluster
          new_cluster:
            cluster_name: ""
            spark_version: 15.4.x-scala2.12
            spark_conf:
              spark.master: local[*, 4]
              spark.databricks.cluster.profile: singleNode
            azure_attributes:
              first_on_demand: 1
              availability: ON_DEMAND_AZURE
              spot_bid_max_price: -1
            node_type_id: Standard_D32as_v5
            driver_node_type_id: Standard_D32as_v5
            custom_tags:
              cost_center: "100.001"
              project: geral
              domain: misc
              env: prod
              ResourceClass: SingleNode
            spark_env_vars:
              PYSPARK_PYTHON: /databricks/python3/bin/python3
            enable_elastic_disk: true
            #policy_id: "0013174633674821"
            data_security_mode: SINGLE_USER
            runtime_engine: STANDARD
            num_workers: 0
      tags:
        cost_center: "100.001"
        domain: misc
        env: prod
        project: geral
        uc_name: Geração de Dados
        uc_step: "0"
      queue:
        enabled: true
      parameters:
        - name: p_catalog
          default: ${var.catalog_name}
